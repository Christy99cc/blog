---
title: 04Google云计算技术之GFS
date: 2020-08-19T18:00:00Z
tags:
- 分布式系统与云计算概论
categories: ''

---

## Google云计算技术简介

#### GFS

1. Google File System
2. 支持海量存储

#### MapReduce

1. 用于大规模数据集的并行运算。
2. 主要功能：是提供了一个简单强大的接口，可以将计算自动的并发和分布执行。
3. 从两方面提升了系统：
   * 失效的计算机问题。
   * MapReduce之间传输的数据都是经过压缩的，节省了带宽

#### BigTable

用来管理大规模**结构化**数据的分布式存储系统

## Google文件系统GFS

### 系统架构

* Google GFS是一个基于分布式集群的大型分布式文件系统，为MapReduce计算框架提供低层数据存储和数据可靠性支撑
* GFS是一个构建在分布节点本地文件系统之上的一个**逻辑文件系统**，它将数据存储在物理上分布的每个节点上，但通过GFS将整个数据形成一个逻辑上整体的文件。

![](https://cdn.sparkling.land/christy/images/image-20200316230647221.png)

#### GFS的3个假设

1. 硬件出错是正常而非异常
   * 大量廉价、易损的硬件
   * 必须保持文件系统整体的可靠性
2. 主要负载是流数据读写
   * 主要用于程序处理批量数据，而非用户的交互或随机读写
   * 主要是追加写（插入写非常少）
3. 需要存储大尺寸的文件
   * GB或TB量级

#### GFS的设计思想🌿🌿

1. 将文件划分为若干块（Chunk）存储
   * 固定大小64M
2. 通过冗余来提高可靠性
   * 3个数据块服务器上存储副本
3. 通过单个master来协调数据访问、元数据存储
   * 结构简单，容易保持元数据一致性

#### **系统架构**

![](https://cdn.sparkling.land/christy/images/GFS系统架构.png)

> ⚠️Client与Master之间只有控制信息，无数据信息，减少主服务器的负载。

#### 系统节点分为三类角色🌿🌿🌿

Client 客户端

* 提供给App的访问接口
* 以库文件的形式提供

Master 主服务器

* GFS的管理节点
* 负责整个文件系统的管理
* 🐰逻辑上只有一个

Chunk Server 数据块服务器

* 负责具体的存储工作
* 🐰创建冗余，避免服务器崩溃

#### GFS的实现机制

1. 客户端首先访问Master节点，获取交互的Chunk Server信息，然后访问这些Chunk Server，完成数据存取工作。这种设计方法实现了**控制流和数据流**的分离。
2. **Client与Master之间只有控制流，而无数据流**，极大地降低了Master的负载。
3. **Client与Chunk Server之间直接传输数据流🌿**，同时由于文件被分成多个Chunk进行分布式存储，Client可以同时访问多个Chunk Server，从而**使得整个系统的I/O高度并行，系统整体性能得到提高**。

#### GFS的读操作/数据访问的过程 🌿

> 可以通过系统架构图来理解

1. 在程序运行前，数据已经存储在GFS文件系统中；程序执行时，App告诉Master**文件名或数据块索引**是什么
2. Master根据**文件名**或数据块索引在其文件目录空间中**查找和定位**该文件或数据块，并找到数据块在具体哪些**Chunk Server**上；将**位置信息**返回给App
3. App根据返回的**具体Chunk数据块位置信息**，直接访问相应的CS
4. App根据返回的**具体Chunk数据块位置信息**，直接读取指定位置的数据进行计算处理

#### GFS的特点🌿

1. 采用**中心服务器**模式
   * 可以方便地增加Chunk Server
   * Master掌握系统内所有Chunk Server的情况，方便进行负载均衡
   * 不存在元数据的一致性问题
2. **不缓存数据**
   * 文件操作大部分是流式读写，不存在大量重复读写，使用Cache对性能提高不大
   * Chunk Server上数据存取使用本地文件系统
   * 从可行性看，Cache与实际数据的一致性维护也极其复杂
3. **在用户态下实现**
   * 用户态下有多种调试工具,利于开发
   * Master和Chunk Server都以进程方式运行，单个进程不影响整个操作系统
   * GFS和操作系统运行在不同的空间，两者耦合性降低

### 容错机制

#### Master容错🌿🌿🌿

##### 三类元数据

1. 命名空间，即整个文件系统的目录结构 --- **日志**
2. Chunk与文件名的映射表 --- **日志**
3. Chunk副本的位置信息
   * 一个Chunk默认有3个**副本**
   * 直接保存在各个Chunk Server上

##### Master故障

当Master发生故障时，在磁盘数据保存完好的情况下，可以迅速恢复以上元数据

为了防止Master彻底死机的情况，GFS还提供了Master远程的实时备份

#### Chunk Server容错

1. GFS采用**副本**的方式实现Chunk Server的容错
2. 每一个Chunk有多个存储副本（默认为三个）
3. 对于每一个Chunk，**必须将所有的副本全部写入成功**，才视为成功写入
4. 相关的副本出现丢失或不可恢复等情况，Master自动将该副本**复制**到其他Chunk Server
5. GFS中的每一个文件被划分成多个Chunk，Chunk的默认大小是**64MB**

   ### **系统管理技术**
   * 大规模集群安装技术
     * GFS集群中通常有**非常多的节点**，需要相应的技术支撑
   * 故障检测技术
     * GFS构建在**不可靠廉价计算机**之上的文件系统，由于节点数目众多，故障发生十分频繁
   * 节点动态加入技术
     * 新的Chunk Server加入，只需裸机加入，大大减少GFS维护工作量
   * 节能技术
     * Google采用了多种机制降低服务器能耗，如采用蓄电池代替昂贵的UPS