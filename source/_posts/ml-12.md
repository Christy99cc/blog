---
title: "【ML】异常检测"
date: 2020-11-18T16:00:00Z
tags:
- 机器学习
categories: ''

---
> 吴恩达机器学习

## 问题动机
什么是异常检测？

假想你是一个飞机引擎制造商，当你生产的飞机引擎从生产线上流出时，你需要进行**QA**(质量控制测试)，而作为这个测试的一部分，你测量了飞机引擎的一些特征变量，比如引擎运转时产生的热量，或者引擎的振动等等。

这样一来，你就有了一个数据集，将这些数据绘制成图表：
![image](https://cdn.sparkling.land/christy/images/1692BA76-BC0C-4394-A370-1C144E0EBE4B.jpg)￼

这里的每个点、每个叉，都是无标签数据。

异常检测问题就是：
假设后来有一天，你有一个新的飞机引擎从生产线上流出，而你的新飞机引擎有特征变量x(test)；我们希望知道这个新的飞机引擎是否有某种异常，或者说，我们希望判断这个引擎是否需要进一步测试。因为，如果它看起来像一个正常的引擎，那么我们可以直接将它运送到客户那里，而不需要进一步的测试。


## 高斯分布
略
## 算法
应用高斯分布开发异常检测算法。

异常检测算法：


![image](https://cdn.sparkling.land/christy/images/3C36CB19-BB91-435A-BD80-13D896E19B30.jpg)￼



## 开发和评估异常检测系统

异常检测算法是一个非监督学习算法，意味着我们无法根据结果变量 $ y$ 的值来告诉我们数据是否真的是异常的。我们需要另一种方法来帮助检验算法是否有效。当我们开发一个异常检测系统时，我们从带标记（异常或正常）的数据着手，我们从其中选择一部分正常数据用于构建训练集，然后用剩下的正常数据和异常数据混合的数据构成交叉检验集和测试集。


![image](D81B0663-5254-45BC-A566-688BF303B304.jpg)￼
例如：我们有10000台正常引擎的数据，有20台异常引擎的数据。 我们这样分配数据：

6000台正常引擎的数据作为训练集（y=0）

2000台正常引擎（y=0）和10台异常引擎（y=1）的数据作为交叉检验集

2000台正常引擎（y=0）和10台异常引擎（y=）的数据作为测试集


具体的评价方法如下：

1. 根据测试集数据，我们估计特征的平均值和方差并构建$p(x)$函数

2. 对交叉检验集，我们尝试使用不同的$\varepsilon$值作为阀值，并预测数据是否异常，根据$F1$值或者查准率与查全率的比例来选择 $\varepsilon$

3. 选出 $\varepsilon$ 后，针对测试集进行预测，计算异常检验系统的$F1$值，或者查准率与查全率之比
![image](https://cdn.sparkling.land/christy/images/28619E37-C397-46D6-859E-7F54BB61C09F.jpg)￼

## 异常检测vs监督学习
之前我们构建的异常检测系统也使用了带标记的数据，与监督学习有些相似，进行一个对比


| 异常检测 | 监督学习 |
| 非常少量的正样本（异常数据 $y=1$）, 大量的负样本（$y=0$) | 同时有大量的正样本和负向样本 |
| 许多不同种类的异常，非常难。根据非常少量的正样本数据来训练算法。  | 有足够多的正向类实例，足够用于训练算法，未来遇到的正向类实例可能与训练集中的非常近似 |
| 未来遇到的异常可能与已掌握的异常、非常的不同 |  |
| 例如：欺诈行为检测生产（例如飞机引擎）检测数据中心的计算机运行状况

 | 例如：邮件过滤器 天气预报 肿瘤分类 |
￼



## 选择要使用的特征

### 使用高斯特征来建模
使用高斯特征来建模，不是高斯的特征需要转换成高斯特征
![image](https://cdn.sparkling.land/christy/images/5F7B0595-A446-4302-932F-11E26CDCFD5C.jpg)￼

### 如何转换成异常检测的特征
通过**误差分析**

#### 误差分析

一个常见的问题是一些异常的数据可能也会有较高的$p(x)$值，因而被算法认为是正常的。这种情况下误差分析能够帮助我们，我们可以分析那些被算法错误预测为正常的数据，观察能否找出一些问题。我们可能能从问题中发现我们需要增加一些新的特征，增加这些新特征后获得的新算法能够帮助我们更好地进行异常检测。


#### 异常检测误差分析
![image](https://cdn.sparkling.land/christy/images/66F61621-F0BF-4B83-AABC-23C2E498D7EC.jpg)￼
![image](https://cdn.sparkling.land/christy/images/E0C99DEF-B8F2-437D-9F5F-7785BAAC2AB3.jpg)￼
我们通常可以通过将一些相关的特征进行组合，来获得一些新的更好的特征（异常数据的该特征值异常地大或小），例如，在检测数据中心的计算机状况的例子中，我们可以用**CPU**负载与网络通信量的比例作为一个新的特征，如果该值异常地大，便有可能意味着该服务器是陷入了一些问题中。


## 多变量高斯分布
![image](https://cdn.sparkling.land/christy/images/3B081F1D-5F55-465A-BFDE-FA61F2FBE2D52.jpg)￼
![image](https://cdn.sparkling.land/christy/images/C72B0C2F-7E98-402A-9262-1D1FD9344C44.jpg)￼


![image](https://cdn.sparkling.land/christy/images/33A2A70B-CFA2-47CB-BE03-D3B89AD25205.jpg)￼
## 使用多变量高斯分布的异常检测


